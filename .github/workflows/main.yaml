# .github/workflows/main.yaml
# Copyright 2023 Keith Maxwell
# SPDX-License-Identifier: CC0-1.0

on: # yamllint disable-line rule:truthy
  push:
    branches: [main]
    tags: [v*]
  pull_request: { branches: [main] }
  workflow_dispatch:

permissions: {}

jobs:
  nox: { uses: ./.github/workflows/nox.yaml }
  publish:
    needs: [nox]
    runs-on: ubuntu-latest
    if: ${{ startsWith(github.ref, 'refs/tags/') }}
    permissions: { id-token: write }  # trusted publishing
    environment:
      name: pypi
      url: >-
        https://pypi.org/project/dotlocalslashbin/${{
          needs.nox.outputs.version }}/
    steps:
      # yamllint disable-line rule:line-length
      - uses: actions/download-artifact@70fc10c6e5e1ce46ad2ea6f2b72d43f7d47b13c3 # v8
        with: { name: artifact, path: dist }
      # yamllint disable-line rule:line-length
      - uses: pypa/gh-action-pypi-publish@ed0c53931b1dc9bd32cbe73a98c7f6766f8a527e # v1.13.0
        # https://github.com/pypa/gh-action-pypi-publish/blob/release/v1/action.yml
        with: { print-hash: true }
